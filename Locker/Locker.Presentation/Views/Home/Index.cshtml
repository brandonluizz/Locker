@{
    ViewBag.Title = "Login";
}

<h2>Entrar</h2>
<form class="form-horizontal " data-bind="submit: LoginSubmit">
    <div class="form-group">
        <label class="control-label col-sm-2" for="login">Login:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" id="Login" placeholder="Login" name="Login" data-bind="value: Login">
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-sm-2" for="pwd">Senha:</label>
        <div class="col-sm-10">
            <input type="password" class="form-control" id="pwd" placeholder="Senha" name="Password" data-bind="value: Password">
        </div>
    </div>
    <div class="form-group" data-bind="visible: IsIncorrectPassword">
        <label class="control-label col-sm-2" for="pwd"></label>
        <div class="col-sm-10">
            <div class="alert alert-warning col-sm-4" role="alert">Login ou a senha incorretos</div>
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-default">Entrar</button>
        </div>
    </div>
</form>

<script>
    $(document).ready(function () {

        var viewModel = function () {
            var self = this;

            self.Login = ko.observable('');
            self.Password = ko.observable('');
            self.IsIncorrectPassword = ko.observable(false);

            self.LoginSubmit = function (formElement) {
                if (self.FormDataSuccess()) {
                    $.post('/Home/DoLogin/', $(formElement).serialize(), SubmittedWithSuccess, 'json');
                }
            };

            self.FormDataSuccess = function () {
                if (self.Login === '') { return false; }
                if (self.Password === '') { return false; }

                return true;
            }

            function SubmittedWithSuccess(data) {
                if (data.Success) {
                    window.location = "pagina-principal";
                    //redirecionar para tela inicial
                    self.IsIncorrectPassword(false);
                } else {
                    self.IsIncorrectPassword(true);
                }                
            }
        }

        ko.applyBindings(new viewModel());
    });
</script>