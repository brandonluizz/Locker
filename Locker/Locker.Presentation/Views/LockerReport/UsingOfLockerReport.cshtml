
@{
    ViewBag.Title = "Relatório - Utilização de Armários";
}
<!-- Styles -->
<style>
    #chartdiv {
        width: 100%;
        height: 500px;
    }

    .amcharts-export-menu-top-right {
        top: 10px;
        right: 0;
    }
</style>
<h3>Relatório de Utilização de Armários</h3>
<hr />

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">
            Relatório
        </h3>
    </div>
    <div class="panel-body">

        <table class="table table-hover" id="table">
            <thead>
                <tr>
                    <th>Data/Hora</th>
                    <th>Localização do Setor</th>
                    <th>Setor</th>
                    <th>Total Unidades</th>
                    <th>Qtde Armários Utilizados</th>
                    <th>% de Utilização</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<link rel="stylesheet" href="~/node_modules/datatables.net-dt/css/jquery.dataTables.css" type="text/css" />
<script src="~/node_modules/datatables.net/js/jquery.dataTables.js"></script>
<script src="~/Scripts/amcharts/amcharts.js"></script>
<script src="~/Scripts/amcharts/lang/pt.js"></script>
<script src="~/Scripts/amcharts/serial.js"></script>
<script src="~/Scripts/amcharts/plugins/export/export.min.js"></script>
<link rel="stylesheet" href="~/Scripts/amcharts/plugins/export/export.css" type="text/css" media="all" />
<script src="~/Scripts/amcharts/themes/light.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var viewModel = function () {
            var self = this;

            function GetReport() {
                $.ajax({
                    type: 'GET',
                    url: '/LockerReport/GetUsingOfLockerReport/',
                    success: function (data) {
                        if (data) {
                            var response = $.parseJSON(JSON.stringify(data));
                          
                            console.log(data);
                            var chart = AmCharts.makeChart("chartdiv", {
                                "type": "serial",
                                "theme": "light",
                                "marginRight": 70,
                                "dataProvider": response,
                                "valueAxes": [{
                                    "axisAlpha": 0,
                                    "position": "left",
                                    "title": "Porcentagem de Utilização"
                                }],
                                "startDuration": 1,
                                "graphs": [{
                                    "balloonText": "<b>[[category]]: [[value]]</b>",
                                    "fillColorsField": "color",
                                    "fillAlphas": 0.9,
                                    "lineAlpha": 0.2,
                                    "type": "column",
                                    "valueField": "PercentageOfUse"
                                },
                                {
                                    "id": "graph2",
                                    "balloonText": "<span style='font-size:12px;'>[[title]] em [[category]]:<br><span style='font-size:20px;'>[[value]]</span> [[additional]]</span>",
                                    "bullet": "round",
                                    "lineThickness": 3,
                                    "bulletSize": 7,
                                    "bulletBorderAlpha": 1,
                                    "bulletColor": "#FFFFFF",
                                    "useLineColorForBulletBorder": true,
                                    "bulletBorderThickness": 3,
                                    "fillAlphas": 0,
                                    "lineAlpha": 1,
                                    "title": "Total de Unidade de Armário",
                                    "valueField": "TotalNumberOfLockers",
                                    "dashLengthField": "dashLengthLine"
                                }
                                ],
                                "chartCursor": {
                                    "categoryBalloonEnabled": false,
                                    "cursorAlpha": 0,
                                    "zoomable": false
                                },
                                "categoryField": "SectorName",
                                "categoryAxis": {
                                    "gridPosition": "start",
                                    "labelRotation": 45
                                },
                                "export": {
                                    "enabled": true
                                }

                            });

                            //var chart = AmCharts.makeChart("chartdiv", {
                            //    "type": "pie",
                            //    "theme": "light",
                            //    "dataProvider": response,
                            //    "valueField": "PercentageOfUse",
                            //    "titleField": "FormattedDate",
                            //    "balloon": {
                            //        "fixedPosition": true
                            //    },
                            //    "export": {
                            //        "enabled": true
                            //    }
                            //});

                        }
                    }
                });
            }


            self.InitializeComponent = function () {
                GetReport();
            }();
        }

        $('#table').DataTable({
            "ajax": {
                url: "/LockerReport/GetUsingOfLockerReport/",
                type: 'GET',
                cache: false,
                dataSrc: function (data) {
                    try {
                        debugger;
                        return data;
                    } catch (e) {
                        return false;
                    }
                }
            },
            "columns": [
                { "data": "FormattedDate" },
                { "data": "SectorLocationName" },
                { "data": "SectorName" },
                { "data": "TotalNumberOfLockers" },
                { "data": "TotalLockersOfUsing" },
                { "data": "FormattedPercentageOfUse" }
            ]
        });

        ko.applyBindings(new viewModel());
    });

</script>


<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">
            Gráfico
        </h3>
    </div>
    <div class="panel-body">
        <div id="chartdiv"></div>
    </div>
</div>
<script src="~/Scripts/app/TableFilters.js" type="text/javascript"></script>