
@{
    ViewBag.Title = "Relatório - Utilização de Armários";
}

<h3>Relatório de Utilização de Armários</h3>
<hr />

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">
            Relatório
        </h3>
    </div>
    <div class="panel-body">
        <div class="input-group">
            <span class="input-group-addon" id="sizing-addon2"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
            <input type="text" required id="filterD" class="form-control" placeholder="Buscar item na tabela" data-bind="value:filter,valueUpdate: 'keyup'" />
        </div>
        <hr />
        <table class="table table-hover" id="tabela">
            <thead>
                <tr>
                    <th>Data/Hora</th>
                    <th>Localização do Setor</th>
                    <th>Setor</th>
                    <th>Total Unidades</th>
                    <th>Qtde Armários Utilizados</th>
                    <th>% de Utilização</th>
                </tr>         
            </thead>

            <tbody data-bind="foreach: filteredList">
                <tr>
                    <td data-bind="text: FormattedDate"></td>
                    <td data-bind="text: SectorLocationName"></td>
                    <td data-bind="text: SectorName"></td>
                    <td data-bind="text: TotalNumberOfLockers"></td>
                    <td data-bind="text: TotalLockersOfUsing"></td>
                    <td data-bind="text: FormattedPercentageOfUse"></td>
                </tr>
            </tbody>

        </table>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var viewModel = function () {
            var self = this;

            self.Report = ko.observableArray();
            self.filter = ko.observable();

            self.filteredList = ko.computed(function () {
                var filter = self.filter(),
                    arr = [];
                if (filter) {
                    ko.utils.arrayForEach(self.Report(), function (item) {
                        if (item.FormattedDate.toString().toUpperCase() == filter.toString().toUpperCase()
                            || item.SectorLocationName.toString().toUpperCase() == filter.toString().toUpperCase()
                            || item.SectorName.toString().toUpperCase() == filter.toString().toUpperCase()
                            || item.FormattedPercentageOfUse.toString().toUpperCase() == filter.toString().toUpperCase()
                            || item.TotalNumberOfLockers.toString().toUpperCase() == filter.toString().toUpperCase()
                            || item.FormattedPercentageOfUse.toString().toUpperCase() == filter.toString().toUpperCase()) {

                            arr.push(item);
                        }
                    });
                } else {
                    arr = self.Report();
                }
                return arr;
            });

            function GetReport() {
                $.ajax({
                    type: 'GET',
                    url: '/LockerReport/GetUsingOfLockerReport/',
                    success: function (data) {
                        if (data) {
                            var response = $.parseJSON(JSON.stringify(data));
                            self.Report(response);
                            console.log(response);
                        }
                    }
                });
            }


            self.InitializeComponent = function () {
                GetReport();
            }();
        }

        ko.applyBindings(new viewModel());
    });

</script>
<script src="~/Scripts/app/TableFilters.js" type="text/javascript"></script>